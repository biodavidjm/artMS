#-------------------------------------------------------------------------------
#' @title Generate Phosfate Input file
#' 
#' @description It takes as input the `imputedL2fcExtended.txt` results
#' generated by the `artms_analysisQuantifications()` function and generates
#' the [Phosfate](http://phosfate.com/) input file (or data.frame)
#' Please, notice that the only species suported by Phosfate is humans.
#' @param inputFile (char) the `imputedL2fcExtended.txt` file name and location
#' @param outputDir (char) Name of the folder to output results 
#' (Default: "phosfate_input_files")
#' @param verbose (logical) `TRUE` (default) to show function messages
#' @return Multiple output files (inputs of phosfate)
#' @keywords generate, outputs, files
#' @examples \donttest{
#' artmsPhosfateOutput(inputFile)
#' }
#' @export
artmsPhosfateOutput <- function(inputFile, 
                                outputDir = "phosfate_input_files",
                                verbose = TRUE){

  df <- .artms_checkIfFile(inputFile)
  
  # Check the existance of the columns that are needed.
  checkColumns <- c('Protein', 'PTMsite', 'iLog2FC', 'Comparison')
  
  if (any( !checkColumns %in% colnames(df)) ) {
    stop("One (or many) column names are not found:\n",
         sprintf('%s, ',checkColumns))
  }
    
  # create output directory if it doesn't exist
  if(!dir.exists(outputDir)){
    dir.create(outputDir, recursive = TRUE)
  }
  
  conditions <- unique(df$Comparison)
  
  for ( i in seq_len(length(conditions)) ){
    if(verbose) cat("+---", i, conditions[i])
    df.select <- df[which(df$Comparison == conditions[i]),]
    df.out <- df.select[c('Protein','PTMsite','iLog2FC')]
    fileout <- gsub(".txt","", inputFile)
    fileout <- paste0(fileout,"-",conditions[i],".txt")
    fileout <- paste0(outputDir,"/",fileout)
    write.table(df.out, fileout, col.names = FALSE, 
                row.names = FALSE, 
                quote = FALSE, sep = ",")
    if(verbose) cat(":", fileout, " is out\n")
  }
}

#-------------------------------------------------------------------------------
#' @title Generate PHOTON Input file
#' 
#' @description It takes as input the `imputedL2fcExtended.txt` results
#' generated by the `artms_analysisQuantifications()` function and generates
#' the [PHOTON](https://github.com/jdrudolph/photon) input file.
#' Please, notice that the only species suported by PHOTON is humans.
#' @param inputFile (char) the `imputedL2fcExtended.txt` file name and location
#' @param outputDir (char) Name of the folder to output results 
#' (Default: "photon_input_files")
#' @param verbose (logical) `TRUE` (default) to show function messages
#' @return Multiple output files (inputs of phosfate)
#' @keywords generate, outputs, files
#' @examples \donttest{
#' artmsPhotonOutput(inputFile)
#' }
#' @export
artmsPhotonOutput <- function(inputFile,
                              outputDir = "photon_input_files",
                              verbose = TRUE){
  
  df <- .artms_checkIfFile(inputFile)
  
  # Check the existance of the columns that are needed.
  checkColumns <- c('Gene', 'PTMsite', 'iLog2FC', 'ENTREZID')
  
  if (any( !checkColumns %in% colnames(df)) ) {
    stop("One (or many) column names are not found:\n",sprintf('%s, ',checkColumns))
  }
  
  # create output directory if it doesn't exist
  if(!dir.exists(outputDir)){
    dir.create(outputDir, recursive = TRUE)
  }
  
  conditions <- unique(df$Comparison)
  
  for ( i in seq_len(length(conditions)) ){
    if(verbose) cat("+---", i, conditions[i])
    df.select <- df[which(df$Comparison == conditions[i]),]
    
    # first, filter by pvalue
    df.select <- df.select[which(df.select$iPvalue < 0.05),]
    
    # Photon takes this input columns: GeneID,Amino.Acid,Position,avg,Symbol
    df.out <- df.select[c('Gene','PTMsite','iLog2FC','ENTREZID')]
    df.out$Amino.Acid <- df.select$PTMaa
    df.out <- artmsChangeColumnName(df.out, "ENTREZID", "GeneID")
    df.out <- artmsChangeColumnName(df.out, "PTMsite", "Position")
    df.out <- artmsChangeColumnName(df.out, "iLog2FC", "avg")
    df.out <- artmsChangeColumnName(df.out, "Gene", "Symbol")
    
    df.out <- df.out[c('GeneID', 'Amino.Acid', 'Position', 'avg', 'Symbol')]
    if(any(grep(";", df.out$Symbol))){
      if(verbose) cat("\t---(-) Removed multiple ids from column 'Protein'\n")
      df.out <- df.out[-grep(";", df.out$Symbol),]
    }
    fileout <- gsub(".txt","", inputFile)
    fileout <- paste0("photon.",conditions[i],".csv")
    fileout <- paste0(outputDir,"/",fileout)
    write.table(df.out, fileout, 
                col.names = TRUE, row.names = FALSE, 
                quote = FALSE, sep = ",")
    if(verbose) cat(":",fileout," is out\n")
  }
}


